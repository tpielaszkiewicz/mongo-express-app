/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/base/util/Version","sap/ui/thirdparty/jquery","sap/ui/documentation/sdk/util/Resources"],function(e,t,r,a,o){"use strict";var n=e.extend("sap.ui.core.util.LibraryInfo",{constructor:function(){e.apply(this);this._oLibInfos={}},destroy:function(){e.prototype.destroy.apply(this,arguments);this._oLibInfos={}},getInterface:function(){return this}});function i(e,t){e+=t;e=o.getResourceOriginPath(e);return e}n.prototype._loadLibraryMetadata=function(e,r){e=e.replace(/\//g,".");if(this._oLibInfos[e]){setTimeout(r.bind(window,this._oLibInfos[e]),0);return}var o=this,n,l,f=/themelib_(.*)/i.exec(e);if(!f){l=".library";n=sap.ui.require.toUrl(e.replace(/\./g,"/"))+"/"}else{l=".theme";n=sap.ui.require.toUrl("sap/ui/core/themes/"+f[1]+"/")}a.ajax({url:i(n,l),dataType:"xml",error:function(a,i,f){t.error("failed to load library details from '"+n+l+": "+i+", "+f);o._oLibInfos[e]={name:e,data:null,url:n};r(o._oLibInfos[e])},success:function(t,a,i){o._oLibInfos[e]={name:e,data:t,url:n};r(o._oLibInfos[e])}})};n.prototype._getLibraryInfo=function(e,t){this._loadLibraryMetadata(e,function(e){var r={libs:[],library:e.name,libraryUrl:e.url};if(e.data){var o=a(e.data);r.vendor=o.find("vendor").text();r.copyright=o.find("copyright").text();r.version=o.find("version").text();r.documentation=o.find("documentation").text();r.releasenotes=o.find("releasenotes").attr("url");r.componentInfo=n.prototype._getLibraryComponentInfo(o)}t(r)})};n.prototype._getThirdPartyInfo=function(e,t){this._loadLibraryMetadata(e,function(e){var r={libs:[],library:e.name,libraryUrl:e.url};if(e.data){var o=a(e.data).find("appData").find("thirdparty").children();o.each(function(t,o){if(o.nodeName==="lib"){var n=a(o);var i=n.children("license");r.libs.push({displayName:n.attr("displayName"),homepage:n.attr("homepage"),license:{url:i.attr("url"),type:i.attr("type"),file:e.url+i.attr("file")}})}})}t(r)})};n.prototype._getDocuIndex=function(e,r){this._loadLibraryMetadata(e,function(e){var n=e.name,i=e.url,l={docu:{},library:n,libraryUrl:i};if(!e.data){r(l);return}var f=a(e.data).find("appData").find("documentation");var s=f.attr("indexUrl");if(!s){r(l);return}if(f.attr("resolve")=="lib"){s=e.url+s}s=o.getResourceOriginPath(s);a.ajax({url:s,dataType:"json",error:function(e,a,o){t.error("failed to load library docu from '"+s+"': "+a+", "+o);r(l)},success:function(e,t,a){e.library=n;e.libraryUrl=i;r(e)}})})};n.prototype._getReleaseNotes=function(e,o,n){this._loadLibraryMetadata(e,function(i){if(!i.data){n({});return}var l=o.split(".").length===3&&!/-SNAPSHOT/.test(o);var f=r(o);var s=f.getMajor();var u=f.getMinor();var d=f.getPatch();var p=a(i.data).find("appData").find("releasenotes");var c=p.attr("url");if(!c){t.warning("failed to load release notes for library "+e);n({});return}if(f.getSuffix()==="-SNAPSHOT"){if(u%2!=0){u=u+1;d=0}o=s+"."+u+"."+d}var y=window.location.href,m=/\/\d.\d{1,2}.\d{1,2}\//;if(p.attr("resolve")=="lib"){if(m.test(y)||l===false){c=i.url+c}else{c="{major}.{minor}.{patch}/"+i.url+c}}c=c.replace(/\{major\}/g,s);c=c.replace(/\{minor\}/g,u);c=c.replace(/\{patch\}/g,d);a.ajax({url:c,dataType:"json",error:function(r,a,o){if(a==="parsererror"){t.error("failed to parse release notes for library '"+e+", "+o)}else{t.warning("failed to load release notes for library '"+e+", "+o)}n({})},success:function(e,t,r){n(e,o)}})})};n.prototype._getLibraryComponentInfo=function(e){var t={};var r=[];var a="";e.find("ownership > component").each(function(e,t){if(t.childElementCount===0){a=t.textContent}else{var o=t.getElementsByTagName("name");if(o&&o.length>0){o=o[0].textContent;var n=t.getElementsByTagName("module");if(o&&n&&n.length>0){var i=[];for(var l=0;l<n.length;l++){var f=n[l].textContent.replace(/\//g,".");if(f){i.push(f)}}if(i.length>0){r.push({component:o,modules:i})}}}}});t["defaultComponent"]=a;if(r&&r.length>0){t["specialCases"]=r}return t};n.prototype._getActualComponent=function(e,r){function a(e,t){e=e.toLowerCase();t=t.toLowerCase();return e===t||t.match(/\*$/)&&e.indexOf(t.slice(0,-1))===0||t.match(/\.\*$/)&&e===t.slice(0,-2)}if(r){for(var o in e){if(!e[o]){t.error("No library information deployed for "+o);continue}var n;if(r.indexOf(o)===0){n=e[o].defaultComponent}var i=e[o].specialCases;if(i){for(var l=0;l<i.length;l++){var f=i[l].modules;for(var s=0;s<f.length;s++){if(a(r,f[s])){n=i[l].component}}}}if(n){return n}}}};n.prototype._getDefaultComponent=function(e){return e&&e.componentInfo&&e.componentInfo.defaultComponent};return n});