/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/ShortcutHintsMixin","sap/ui/core/EnabledPropagator","sap/ui/core/IconPool","sap/ui/Device","sap/ui/core/ContextMenuSupport","sap/ui/core/library","./ButtonRenderer","sap/ui/events/KeyCodes","sap/ui/core/LabelEnablement","sap/m/BadgeEnabler","sap/ui/core/InvisibleText"],function(e,t,i,s,n,o,a,r,c,h,p,u,l){"use strict";var d=r.TextDirection;var g=e.ButtonType;var f=e.ButtonAccessibilityType;var _=e.BadgeState;var y=t.extend("sap.m.Button",{metadata:{interfaces:["sap.ui.core.IFormContent"],library:"sap.m",properties:{text:{type:"string",group:"Misc",defaultValue:""},type:{type:"sap.m.ButtonType",group:"Appearance",defaultValue:g.Default},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:null},enabled:{type:"boolean",group:"Behavior",defaultValue:true},icon:{type:"sap.ui.core.URI",group:"Appearance",defaultValue:""},iconFirst:{type:"boolean",group:"Appearance",defaultValue:true},activeIcon:{type:"sap.ui.core.URI",group:"Misc",defaultValue:null},iconDensityAware:{type:"boolean",group:"Misc",defaultValue:true},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:d.Inherit}},associations:{ariaDescribedBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaDescribedBy"},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{tap:{deprecated:true},press:{}},designtime:"sap/m/designtime/Button.designtime",dnd:{draggable:true,droppable:false}}});s.call(y.prototype);a.apply(y.prototype);u.call(y.prototype);y.prototype.init=function(){this._onmouseenter=this._onmouseenter.bind(this);this._buttonPressed=false;i.addConfig(this,{event:"press",position:"0 0",addAccessibilityLabel:true},this);this.initBadgeEnablement({position:"topRight",selector:{suffix:"inner"}});this._oBadgeData={value:"",state:""}};y.prototype.onBadgeUpdate=function(e,t){var i=parseInt(e);if(!this.getDomRef()){return}if(i<1&&t!==_.Disappear){this.updateBadgeVisibility(false);return}else if(i>9999&&e.indexOf("+")===-1){e="999+";this.updateBadgeValue(e);return}if(this._oBadgeData.value!==e||this._oBadgeData.state!==t){this._updateBadgeInvisibleText(e);this._oBadgeData={value:e,state:t};this.invalidate()}};y.prototype._updateBadgeInvisibleText=function(e){var t=sap.ui.getCore().getLibraryResourceBundle("sap.m"),i,s;e=e.toString().trim();s=e.indexOf("+");if(s!==-1){i=t.getText("BUTTON_BADGE_MORE_THAN_ITEMS",e.substr(0,s))}else{switch(e){case"":i="";break;case"1":i=t.getText("BUTTON_BADGE_ONE_ITEM",e);break;default:i=t.getText("BUTTON_BADGE_MANY_ITEMS",e)}}this._getBadgeInvisibleText().setText(i)};y.prototype._getBadgeInvisibleText=function(){return this._oBadgeInvisibleText||(this._oBadgeInvisibleText=new l(this.getId()+"-badge").toStatic())};y.prototype.exit=function(){if(this._image){this._image.destroy()}if(this._iconBtn){this._iconBtn.destroy()}if(this._oBadgeInvisibleText){this._oBadgeInvisibleText.destroy();this._oBadgeData=null}this.$().off("mouseenter",this._onmouseenter)};y.prototype.setType=function(e){this.setProperty("type",e,false);if(e===g.Critical){this._sTypeIconURI="sap-icon://message-warning"}else if(e===g.Negative){this._sTypeIconURI="sap-icon://message-error"}else if(e===g.Success){this._sTypeIconURI="sap-icon://message-success"}else if(e===g.Neutral){this._sTypeIconURI="sap-icon://message-information"}else{this._sTypeIconURI=null}return this};y.prototype.onBeforeRendering=function(){this._bRenderActive=this._bActive;this.$().off("mouseenter",this._onmouseenter)};y.prototype.onAfterRendering=function(){if(this._bRenderActive){this._activeButton();this._bRenderActive=this._bActive}this.$().on("mouseenter",this._onmouseenter)};y.prototype.ontouchstart=function(e){e.setMarked();if(this._bRenderActive){delete this._bRenderActive}if(e.targetTouches.length===1){this._buttonPressed=true;this._activeButton()}if(this.getEnabled()&&this.getVisible()){if((o.browser.safari||o.browser.firefox)&&(e.originalEvent&&e.originalEvent.type==="mousedown")){this._setButtonFocus()}if(!sap.ui.Device.browser.msie){this._sTouchStartTargetId=e.target.id.replace(this.getId(),"")}}else{if(!sap.ui.Device.browser.msie){this._sTouchStartTargetId=""}}};y.prototype.ontouchend=function(e){var t;this._buttonPressed=e.originalEvent&&e.originalEvent.buttons&1;this._inactiveButton();if(this._bRenderActive){delete this._bRenderActive;this.ontap(e,true)}if(!sap.ui.Device.browser.msie){t=e.target.id.replace(this.getId(),"");if(this._buttonPressed===0&&(this._sTouchStartTargetId==="-BDI-content"&&(t==="-content"||t==="-inner"||t==="-img")||this._sTouchStartTargetId==="-content"&&(t==="-inner"||t==="-img")||this._sTouchStartTargetId==="-img"&&t!=="-img")){this.ontap(e,true)}}this._sTouchStartTargetId=""};y.prototype.ontouchcancel=function(){this._buttonPressed=false;this._sTouchStartTargetId="";this._inactiveButton()};y.prototype.ontap=function(e,t){e.setMarked();delete this._bRenderActive;if(this.bFromTouchEnd){return}if(this.getEnabled()&&this.getVisible()){if(e.originalEvent&&e.originalEvent.type==="touchend"){this.focus()}this.fireTap({});this.firePress({})}this.bFromTouchEnd=t;if(this.bFromTouchEnd){setTimeout(function(){delete this.bFromTouchEnd}.bind(this),0)}};y.prototype.onkeydown=function(e){if(e.which===h.SPACE||e.which===h.ENTER||e.which===h.ESCAPE||e.which===h.SHIFT){if(e.which===h.SPACE||e.which===h.ENTER){e.setMarked();this._activeButton()}if(e.which===h.ENTER){this.firePress({})}if(e.which===h.SPACE){this._bPressedSpace=true}if(this._bPressedSpace){if(e.which===h.SHIFT||e.which===h.ESCAPE){this._bPressedEscapeOrShift=true;this._inactiveButton()}}}else{if(this._bPressedSpace){e.preventDefault()}}};y.prototype.onkeyup=function(e){if(e.which===h.ENTER){e.setMarked();this._inactiveButton()}if(e.which===h.SPACE){if(!this._bPressedEscapeOrShift){e.setMarked();this._inactiveButton();this.firePress({})}else{this._bPressedEscapeOrShift=false}this._bPressedSpace=false}if(e.which===h.ESCAPE){this._bPressedSpace=false}};y.prototype._onmouseenter=function(e){if(this._buttonPressed&&e.originalEvent&&e.originalEvent.buttons&1){this._activeButton()}};y.prototype.onfocusout=function(){this._buttonPressed=false;this._sTouchStartTargetId="";this._inactiveButton()};y.prototype._activeButton=function(){if(!this._isUnstyled()){this.$("inner").addClass("sapMBtnActive")}this._bActive=this.getEnabled();if(this._bActive){if(this._getAppliedIcon()&&this.getActiveIcon()&&this._image){this._image.setSrc(this.getActiveIcon())}}};y.prototype._inactiveButton=function(){if(!this._isUnstyled()){this.$("inner").removeClass("sapMBtnActive")}this._bActive=false;if(this.getEnabled()){if(this._getAppliedIcon()&&this.getActiveIcon()&&this._image){this._image.setSrc(this._getAppliedIcon())}}};y.prototype._isHoverable=function(){return this.getEnabled()&&o.system.desktop};y.prototype._getImage=function(e,t,i,s){var o=n.isIconURI(t),a;if(this._image instanceof sap.m.Image&&o||this._image instanceof sap.ui.core.Icon&&!o){this._image.destroy();this._image=undefined}a=this.getIconFirst();if(this._image){this._image.setSrc(t);if(this._image instanceof sap.m.Image){this._image.setActiveSrc(i);this._image.setDensityAware(s)}}else{this._image=n.createControlByURI({id:e,src:t,activeSrc:i,densityAware:s,useIconTooltip:false},sap.m.Image).addStyleClass("sapMBtnCustomIcon").setParent(this,null,true)}this._image.addStyleClass("sapMBtnIcon");this._image.toggleStyleClass("sapMBtnIconLeft",a);this._image.toggleStyleClass("sapMBtnIconRight",!a);return this._image};y.prototype._getInternalIconBtn=function(e,t){var i=this._iconBtn;if(i){i.setSrc(t)}else{i=n.createControlByURI({id:e,src:t,useIconTooltip:false},sap.m.Image).setParent(this,null,true)}i.addStyleClass("sapMBtnIcon");i.addStyleClass("sapMBtnIconLeft");this._iconBtn=i;return this._iconBtn};y.prototype._isUnstyled=function(){var e=false;if(this.getType()===g.Unstyled){e=true}return e};y.prototype.getPopupAnchorDomRef=function(){return this.getDomRef("inner")};y.prototype._getText=function(){return this.getText()};y.prototype._getTooltip=function(){var e,t;e=this.getTooltip_AsString();if(!e&&!this.getText()){t=n.getIconInfo(this._getAppliedIcon());if(t){e=t.text?t.text:t.name}}return e};y.prototype._getAppliedIcon=function(){return this.getIcon()||this._sTypeIconURI};y.prototype.getAccessibilityInfo=function(){var e=this.getText()||this.getTooltip_AsString();if(!e&&this._getAppliedIcon()){var t=n.getIconInfo(this._getAppliedIcon());if(t){e=t.text||t.name}}return{role:"button",type:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("ACC_CTR_TYPE_BUTTON"),description:e,focusable:this.getEnabled(),enabled:this.getEnabled()}};y.prototype._setButtonFocus=function(){setTimeout(function(){this.focus()}.bind(this),0)};y.prototype._determineSelfReferencePresence=function(){var e=this.getAriaLabelledBy(),t=e.indexOf(this.getId())!==-1,i=p.getReferencingLabels(this).length>0,s=this.getParent(),n=!!(s&&s.enhanceAccessibilityState);return!t&&this._getText()&&(e.length>0||i||n)};y.prototype._determineAccessibilityType=function(){var e=this.getAriaLabelledBy().length>0,t=this.getAriaDescribedBy().length>0,i=p.getReferencingLabels(this).length>0,s=this.getType()!==g.Default,n=e||i,o=t||s||this._oBadgeData&&this._oBadgeData.value!==""&&this._oBadgeData.State!==_.Disappear,a;if(!n&&!o){a=f.Default}else if(n&&!o){a=f.Labelled}else if(!n&&o){a=f.Described}else if(n&&o){a=f.Combined}return a};y.prototype._getTitleAttribute=function(e){return this.getTooltip()};return y});